<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SAM9X25 Software Package: SD/MMC Initialization and Identification</title>
<link href="common/style.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
    <div id="body">
        <div id="title">ATSAM9X25 Software Package 1.0</div>
        <div id="banner"></div>

<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="sdmmc_lib.html">SD/MMC Library</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>SD/MMC Initialization and Identification </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="Purpose"></a>
Purpose</h2>
<p>sdcard sd mode initialization and identification sequence</p>
<h2><a class="anchor" id="sdmmc_identify_desc"></a>
Description</h2>
<ul>
<li>Host write bit 3 of function 0, register 6 to reset SDIO card (if there is, using Cmd52).</li>
<li>Host sends Cmd0 to do card reset, card is in "idle state".</li>
<li>Host sends Cmd8 and checks the response of the card, only sdcard supports physical layer version 2.00 will response correctly to Cmd8, and this command is mandatory to be sent before ACmd41 for sdcard which support physical layer version 2.00, to enable new functions or to validate a dual-voltage card.<ul>
<li>The response result is saved for future branch after "Host sends Cmd5..".</li>
<li>refer to <a class="el" href="sdmmc_identify.html#sd_cmd8_ok">If Cmd8 response ok</a> branch for the initialize of sdcard 2.0.</li>
<li>refer to <a class="el" href="sdmmc_identify.html#sd_cmd8_fail">If Cmd8 response fail</a> branch for the initialize of sdcard 1.x, mmc card, sdcard2.0 with invalid voltage.</li>
</ul>
</li>
<li>Host sends Cmd5 with argument 0 and checks the response of the card, only SDIO card supports this command. It starts SDIO initialize. The card returns number of functions in response.<ul>
<li>refer to <a class="el" href="sdmmc_identify.html#sd_cmd5_ok">If Cmd5 response ok</a> branch for the initialize of SDIO card.</li>
</ul>
</li>
<li><a class="anchor" id="sd_cmd5_ok"></a> If Cmd5 response ok<ul>
<li>Host sends Cmd5 with argument "voltage range" to power up the SDIO card.</li>
<li>If the response failed, it means the card does not match the voltage desired by the host, SDIO type saved as false.</li>
<li>If the response ok, SDIO type saved as true, continue to next step.</li>
</ul>
</li>
<li><a class="anchor" id="sd_cmd8_ok"></a> If Cmd8 response ok<ul>
<li>Host sends ACmd41* with argument "HCS" equal to "1".</li>
<li>If the response to ACmd41 failed, it means the card does not match the voltage desired by the host, SD card type saved as true.</li>
<li>If the response with "CCS" equal to "1", the card is a version 2.0 high capacity sdcard, refer to <a class="el" href="sdmmc_identify.html#sd_card_init">Card Initialize</a> for the succeeding initialize sequence.</li>
<li>If the response with "CCS" equal to "0", the card is a version 2.0 standard capacity sdcard. refer to <a class="el" href="sdmmc_identify.html#sd_card_init">Card Initialize</a> for the succeeding initialize sequence.</li>
</ul>
</li>
<li><a class="anchor" id="sd_cmd8_fail"></a> If Cmd8 response fail<ul>
<li>Host sends ACmd41* argument "HCS" equal to "0".</li>
<li>If the response to ACmd41 ok, the card is a version 1.x sdcard, refer to <a class="el" href="sdmmc_identify.html#sd_card_init">Card Initialize</a> for the succeeding initialize sequence.</li>
<li>If the response to ACmd41 fails<ul>
<li>If SDIO type is true, refer to <a class="el" href="sdmmc_identify.html#sd_card_init">Card Initialize</a>.</li>
<li>Host sends Cmd0 to reset card.</li>
<li>Host sends Cmd1 with argument "hdSupport" equal to "1" to card.</li>
<li>If card has response to Cmd1, the card is a MMC card, refer to <a class="el" href="sdmmc_identify.html#sd_card_init">Card Initialize</a> for the succeeding initialize sequence. Furthermore, if the response with bit[30:29] equal to "00" or "11", the card is a High Density MMC, else the card is a standard MMC.</li>
<li>If card has no response to Cmd1, the card is either an unknown card or a card does not match host's voltage, the initialize ends.</li>
</ul>
</li>
</ul>
</li>
<li><a class="anchor" id="sd_card_init"></a> Card Initialize<ul>
<li>If SD or MMC type is true, Host sends Cmd2 to get the its unique card identification number (CID).</li>
<li>Host sends Cmd3 to ask the card to publish a new relative card address (RCA), once the RCA is received the card state changes to the "stand-by state".</li>
<li>If SD or MMC type is true, Host sends Cmd9 to get the Card Specific Data (CSD).</li>
<li>At this stage, the initialization and identification process is over, the following steps are done for the sdcard's succeeding operation.</li>
<li>SD(HC) or MMC(HD) memory cards<ul>
<li>Host sends Cmd13 to obtain the card status, make sure the card is "ready-for-data".</li>
<li>Host sends Cmd7 to transit card in "transfer state".</li>
<li>If card is a sdcard*, hosts send ACmd6 to set bus to 4-wire mode.</li>
<li>If card is a mmc card, the bus is set as 1-wire mode.</li>
</ul>
</li>
<li>SDIO card<ul>
<li>the bus is set as 1-wire mode.</li>
</ul>
</li>
</ul>
</li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>Send Cmd55 before send ACmd41. </dd>
<dd>
sdcard include ver 1.x sdcard, ver2.0 standard capacity sdcard, ver2.0 high capacity sdcard </dd></dl>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
