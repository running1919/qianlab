<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SAM9X25 Software Package: USB CDC(Serial)+MSD Example</title>
<link href="common/style.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
    <div id="body">
        <div id="title">ATSAM9X25 Software Package 1.0</div>
        <div id="banner"></div>

<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="page_examples.html">Examples for SAM9X25-EK</a>      </li>
      <li><a class="el" href="page_examples_usb.html">USB Examples</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>USB CDC(Serial)+MSD Example </h1>  </div>
</div>
<div class="contents">
<h2><a class="anchor" id="Purpose"></a>
Purpose</h2>
<p>The USB CDCMSD Project will help you to get familiar with the USB Device Port(UDP)interface and also some of the other interfaces in AT91SAM microcontrollers. Also it can help you to be familiar with the USB Framework that is used for rapid development of USB-compliant class drivers such as USB Communication Device class (CDC), and how to combine two USB functions to a single CDCMSD device (such as CDC + MSD).</p>
<h2><a class="anchor" id="Requirements"></a>
Requirements</h2>
<p>This package can be used with some of Atmel evaluation kits that have UDP interface, depending on the functions included.</p>
<h2><a class="anchor" id="win_drv_update"></a>
Windows Driver Update</h2>
<p>The composite device is generally supported by Microsoft windows, but some patches are needed for muti-interface functions such as CDC &amp; Audio. The example composite devices are tested under windows XP (SP3). For CDC serial port, additional windows driver file (CompositeCDCSerial.inf) can be found at at91lib\usb\device\composite\drv.</p>
<p>The following is alternate update to fix the composite device support on windows XP:</p>
<h3><a class="anchor" id="install_win_sp3"></a>
Install Windows Service Pack 3 (SP3)</h3>
<p>All the fixes for USB generic driver are included in window XP service pack 3. It can be found at <a href="http://technet.microsoft.com/zh-cn/windows/bb794714(en-us).aspx">http://technet.microsoft.com/zh-cn/windows/bb794714(en-us).aspx</a> .</p>
<h3><a class="anchor" id="install_win_hotfix"></a>
Install Windows Hot Fixes</h3>
<p>Two hot fixes are necessary for window to recognize the composite device correctly:</p>
<ol type="1">
<li><a href="http://support.microsoft.com/kb/814560">http://support.microsoft.com/kb/814560</a></li>
<li><a href="http://support.microsoft.com/kb/918365">http://support.microsoft.com/kb/918365</a></li>
</ol>
<h2><a class="anchor" id="Description"></a>
Description</h2>
<p>The demo simulates a USB composite device that integrates USB CDC Serial RS232 Converter function and USB Disk function.</p>
<p>When an EK running this program connected to a host (PC for example), with USB cable, host will notice the attachment of a USB device. No device driver offered for the device now.</p>
<h2><a class="anchor" id="Usage"></a>
Usage</h2>
<ol type="1">
<li>Build the program and download it inside the evaluation board. Please refer to the <a href="http://www.atmel.com/dyn/resources/prod_documents/doc6421.pdf">SAM-BA User Guide</a>, the <a href="http://www.atmel.com/dyn/resources/prod_documents/doc6310.pdf">GNU-Based Software Development</a> application note or to the <a href="ftp://ftp.iar.se/WWWfiles/arm/Guides/EWARM_UserGuide.ENU.pdf">IAR EWARM User Guide</a>, depending on your chosen solution.</li>
<li>On the computer, open and configure a terminal application (e.g. HyperTerminal on Microsoft Windows) with these settings:<ul>
<li>115200 bauds</li>
<li>8 bits of data</li>
<li>No parity</li>
<li>1 stop bit</li>
<li>No flow control</li>
</ul>
</li>
<li>Start the application.</li>
<li>In the terminal window, the following text should appear: <div class="fragment"><pre class="fragment">     -- USB CDCMSD Device Project xxx --
     -- AT91xxxxxx-xx
     -- Compiled: xxx xx xxxx xx:xx:xx --
</pre></div></li>
<li>When connecting USB cable to windows, the LED blinks, and the host reports a new USB device attachment.</li>
<li>For the windows driver installation and the test functions, please refer to "USB CDC serial converter" &amp; "USB Device Mass Storage Project".</li>
<li>You can use the inf file libraries\usb\device\composite\drv\CompositeCDCSerial.inf to install the CDC serial port.</li>
</ol>
<h2><a class="anchor" id="References"></a>
References</h2>
<ul>
<li><a class="el" href="usb_2usb__iad__cdc__msd_2main_8c.html">usb_iad_cdc_msd/main.c</a></li>
<li>pio: <a class="el" href="struct_pin.html">Pin</a> configurations and peripheral configure.</li>
<li>memories: Storage Media interface for MSD</li>
<li>usb: USB Device Framework, USB CDC driver and UDP interface driver<ul>
<li><a class="el" href="usbd_framework.html">AT91 USB device framework</a><ul>
<li><a class="el" href="usbd_api.html">USBD API</a></li>
</ul>
</li>
<li><a class="el" href="group__usbd__composite.html">composite</a><ul>
<li><a class="el" href="usbd_composite_drv.html">USB Composite Devices Drivers</a></li>
</ul>
</li>
<li><a class="el" href="group__usbd__msd.html">massstorage</a><ul>
<li><a class="el" href="usbd_msd_drv.html">USB Device Massstorage Driver</a></li>
</ul>
</li>
<li><a class="el" href="group__usbd__cdc.html">cdc-serial</a><ul>
<li><a class="el" href="usbd_cdc_serial_drv.html">USB Device CDC Serial Driver</a></li>
</ul>
</li>
</ul>
</li>
<li>projects:<ul>
<li><a class="el" href="usb_massstorage.html">USB Device Mass Storage Example</a></li>
<li><a class="el" href="usb_cdc_serial.html">USB CDC Serial Converter Example</a> </li>
</ul>
</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
