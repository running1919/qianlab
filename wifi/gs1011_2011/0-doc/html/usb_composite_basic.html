<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SAM9X25 Software Package: USB Composite Basics</title>
<link href="common/style.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
    <div id="body">
        <div id="title">ATSAM9X25 Software Package 1.0</div>
        <div id="banner"></div>

<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="usb_library.html">USB Library</a>      </li>
      <li><a class="el" href="usbd_framework.html">AT91 USB device framework</a>      </li>
      <li><a class="el" href="usbd_composite_drv.html">USB Composite Devices Drivers</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>USB Composite Basics </h1>  </div>
</div>
<div class="contents">
<p>This page gives generic details on the USB Composite Devices.</p>
<h2><a class="anchor" id="Purpose"></a>
Purpose</h2>
<p>The Universal Serial Bus (USB) offers an easy way to connect PC with portable devices and to expand external peripherals. Usually a USB device provides a single function to the host, such as a storage disk, serial RS-232 port, digital microphone, or speakers, so one function occupies one USB port. Nevertheless, to allow several functions through a single physical port, the USB specification mentions two kinds of devices:</p>
<ul>
<li>Composite device: a device has multiple logical interfaces controlled independently of each other. A single physical logical address is used for the device.</li>
<li>Compound device: a separate hub with multiple functions attached.</li>
</ul>
<p>Composite devices are an efficient solution to reduce the number of hub and USB cables. To set an example a device being in the same time modem and audio speaker requires only a single USB cable.</p>
<h2><a class="anchor" id="Architecture"></a>
Architecture</h2>
<h3><a class="anchor" id="usb_composite_layers"></a>
USB Composite Composition</h3>
<p>Shows different communication flows between composite clients (host side) and functions (device side).</p>
<div align="center">
<img src="UsbCompositeComposition.png" alt="UsbCompositeComposition.png"/>
<p><strong>USB composite composition</strong></p></div>
 <h3><a class="anchor" id="usb_composite_if"></a>
USB Composite Interfaces</h3>
<p>Interfaces descriptors for composite devices includes all functions' interfaces.</p>
<ul>
<li><em>bInterfaceNumber</em> should start from 0 and then increased by one;</li>
<li>the interfaces that used in the same function should be placed together, that is, the value of <em>bInterfaceNumber</em> should be contiguous;</li>
<li>if two or more interfaces are associated to one device function (such as CDC), the Interface Association Descriptor (IAD, <a class="el" href="usb_composite_basic.html#usb_composite_iad">Interface Association Descriptor</a>) is used.</li>
</ul>
<p>Following is architecture of interface for single/multi interface functions.</p>
<div align="center">
<img src="UsbCompositeSingleIF.png" alt="UsbCompositeSingleIF.png"/>
<p><strong>USB Composite Device with SINGLE-interface-functions</strong></p></div>
 <div align="center">
<img src="UsbCompositeMultiIF.png" alt="UsbCompositeMultiIF.png"/>
<p><strong>USB Composite Device with MULTI-interface-functions</strong></p></div>
 <h3><a class="anchor" id="usb_composite_iad"></a>
Interface Association Descriptor</h3>
<p>The Interface Association Descriptor (IAD) is a new standard descriptor defined in USB Engineering Change Notice, to allow a device to describe which interfaces are associated with the same device function. This allows the Operation System to bind all of the appropriate interfaces to the same driver instance for the function. Please see USB ENGINEERING CHANGE NOTICE (Title: <a href="http://www.usb.org/developers/docs/InterfaceAssociationDescriptor_ecn.pdf">Interface Association Descriptor</a>) for detailed information.</p>
<p>The IAD is used to describe that two or more interfaces are associated to the same function. The 'association' includes two or more interfaces and all of their alternative setting interfaces. A device must use an IAD for each multi- interfaced device function. An IAD is always returned as part of the configuration information returned by a GetConfigurationDescriptor request. It must be located before the interface descriptors (including all alternate settings) for the interfaces it associates with. All of the interface numbers in a particular set of associated interfaces must be contiguous. Following shows the standard interface association descriptor includes function class, subclass and protocol fields. The values in these fields can be the same as the values from interface class, subclass and protocol from any one of the associated interfaces.</p>
<table class="doxtable">
<tr>
<td><b>Offset</b> </td><td><b>Field</b> </td><td><b>Size</b> </td><td><b>Value</b> </td><td><b>Description</b> </td></tr>
<tr>
<td>0 </td><td>bLength </td><td>1 </td><td>Number </td><td>Size of descriptor in bytes </td></tr>
<tr>
<td>1 </td><td>bDescriptorType </td><td>1 </td><td>Constant </td><td>INTERFACE ASSOCIATION Descriptor </td></tr>
<tr>
<td>2 </td><td>bFirstInterface </td><td>1 </td><td>Number </td><td>Interface Number of the first interface that is associated with this function. </td></tr>
<tr>
<td>3 </td><td>bInterfaceCount </td><td>1 </td><td>Number </td><td>Number of contiguous interfaces that are associated with this function. </td></tr>
<tr>
<td>4 </td><td>bFunctionClass </td><td>1 </td><td>Class </td><td>Class code (assigned by USB-IF).<br/>
 A value of zero is not allowed in this descriptor. If this field is FFH, the function class is vendor- specific.<br/>
 All Other values are reserved for assignment by the USB-IF. </td></tr>
<tr>
<td>5 </td><td>bFunctionSubClass </td><td>1 </td><td>SubClass </td><td>Subclass code (assigned by USB-IF).<br/>
 If the bFunctionClass field is not set to FFH all values are reserved for assignment by the USB-IF. </td></tr>
<tr>
<td>6 </td><td>bFunctionProtocol </td><td>1 </td><td>Protocol </td><td>Protocol code (assigned by USB-IF).<br/>
 These codes are qualified by the values of the bFunctionClass and bFunctionSubClass fields. </td></tr>
<tr>
<td>7 </td><td>iFunction </td><td>1 </td><td>Index </td><td>Index of string descriptor which describes this function. </td></tr>
</table>
<p>Since this particular feature was not included in earlier versions of the USB specification, there is issue about how existing USB OS implementations will support devices that use this descriptor. It is strongly recommended that the device implementation utilizing the interface association descriptor use the Multi-interface Function Class code in the device descriptor. The Multi-Interface Function Class code is documented on the <a href="http://www.usb.org/developers/docs">http://www.usb.org/developers/docs</a> web site.</p>
<h3><a class="anchor" id="Requests"></a>
Requests</h3>
<p>No special request is used for a composite device, all requests are defined by the device function that is integrated.</p>
<h2><a class="anchor" id="usb_composite_basic_driver"></a>
Host Drivers</h2>
<p>See <a class="el" href="usb_composite_host_driver.html">Composite Host Drivers</a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
